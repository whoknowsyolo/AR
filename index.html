<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Emergency AR Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: Arial, sans-serif;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            overflow: hidden;
        }
        
        #camera-view {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #game-ui {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 10px;
            z-index: 100;
        }
        
        .extinguisher {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border: 3px solid white;
            transition: transform 0.2s;
        }
        
        .extinguisher:active {
            transform: scale(0.9);
        }
        
        #extinguisher-water {
            background-color: red;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C9.8 2 8 3.8 8 6v6.5C6.8 13.2 6 14.5 6 16c0 3.3 2.7 6 6 6s6-2.7 6-6c0-1.5-.8-2.8-2-3.5V6c0-2.2-1.8-4-4-4zm0 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>');
        }
        
        #extinguisher-foam {
            background-color: blue;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C9.8 2 8 3.8 8 6v6.5C6.8 13.2 6 14.5 6 16c0 3.3 2.7 6 6 6s6-2.7 6-6c0-1.5-.8-2.8-2-3.5V6c0-2.2-1.8-4-4-4zm0 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>');
        }
        
        #extinguisher-powder {
            background-color: yellow;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M12 2C9.8 2 8 3.8 8 6v6.5C6.8 13.2 6 14.5 6 16c0 3.3 2.7 6 6 6s6-2.7 6-6c0-1.5-.8-2.8-2-3.5V6c0-2.2-1.8-4-4-4zm0 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>');
        }
        
        #extinguisher-co2 {
            background-color: black;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C9.8 2 8 3.8 8 6v6.5C6.8 13.2 6 14.5 6 16c0 3.3 2.7 6 6 6s6-2.7 6-6c0-1.5-.8-2.8-2-3.5V6c0-2.2-1.8-4-4-4zm0 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>');
        }
        
        .fire {
            position: absolute;
            width: 100px;
            height: 100px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: opacity 0.5s;
        }
        
        .electrical-fire {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9 3c-1.8 1-3.5 2.8-3.9 4.8-.2 1.1.2 2.2.7 3.2.5.9 1.1 1.7 1.5 2.6.4.9.5 1.8.4 2.8-.2 1.2-1 2.1-2.2 2.6.5.6 1.2 1 2 1 2.2 0 4-1.8 4-4 0-1-.4-2-1-2.8.7-1.3 1.7-2.4 2.3-3.8.4-1.1.5-2.2.1-3.3-.4-1-1.2-1.8-2.1-2.4-1.1-.8-1.8-.7-1.8-.7z" fill="%23ffcc00"/><path d="M15 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM12 6.5l5 5h-3v4h-4v-4H7l5-5z" fill="%23ff6600"/></svg>');
        }
        
        .gas-fire {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9 3c-1.8 1-3.5 2.8-3.9 4.8-.2 1.1.2 2.2.7 3.2.5.9 1.1 1.7 1.5 2.6.4.9.5 1.8.4 2.8-.2 1.2-1 2.1-2.2 2.6.5.6 1.2 1 2 1 2.2 0 4-1.8 4-4 0-1-.4-2-1-2.8.7-1.3 1.7-2.4 2.3-3.8.4-1.1.5-2.2.1-3.3-.4-1-1.2-1.8-2.1-2.4-1.1-.8-1.8-.7-1.8-.7z" fill="%23ffcc00"/><circle cx="12" cy="12" r="3" fill="%23ff6600"/></svg>');
        }
        
        .wood-fire {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9 3c-1.8 1-3.5 2.8-3.9 4.8-.2 1.1.2 2.2.7 3.2.5.9 1.1 1.7 1.5 2.6.4.9.5 1.8.4 2.8-.2 1.2-1 2.1-2.2 2.6.5.6 1.2 1 2 1 2.2 0 4-1.8 4-4 0-1-.4-2-1-2.8.7-1.3 1.7-2.4 2.3-3.8.4-1.1.5-2.2.1-3.3-.4-1-1.2-1.8-2.1-2.4-1.1-.8-1.8-.7-1.8-.7z" fill="%23ffcc00"/><path d="M15 9l-2 2-2-2-2 2v5h8v-5l-2-2z" fill="%23964B00"/></svg>');
        }
        
        .liquid-fire {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9 3c-1.8 1-3.5 2.8-3.9 4.8-.2 1.1.2 2.2.7 3.2.5.9 1.1 1.7 1.5 2.6.4.9.5 1.8.4 2.8-.2 1.2-1 2.1-2.2 2.6.5.6 1.2 1 2 1 2.2 0 4-1.8 4-4 0-1-.4-2-1-2.8.7-1.3 1.7-2.4 2.3-3.8.4-1.1.5-2.2.1-3.3-.4-1-1.2-1.8-2.1-2.4-1.1-.8-1.8-.7-1.8-.7z" fill="%23ffcc00"/><path d="M8 14c0 .5.2 1 .5 1.5-.3.5-.5 1-.5 1.5 0 1.7 1.3 3 3 3s3-1.3 3-3c0-.5-.2-1-.5-1.5.3-.5.5-1 .5-1.5 0-1.7-1.3-3-3-3s-3 1.3-3 3z" fill="%230000ff"/></svg>');
        }
        
        .metal-fire {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9 3c-1.8 1-3.5 2.8-3.9 4.8-.2 1.1.2 2.2.7 3.2.5.9 1.1 1.7 1.5 2.6.4.9.5 1.8.4 2.8-.2 1.2-1 2.1-2.2 2.6.5.6 1.2 1 2 1 2.2 0 4-1.8 4-4 0-1-.4-2-1-2.8.7-1.3 1.7-2.4 2.3-3.8.4-1.1.5-2.2.1-3.3-.4-1-1.2-1.8-2.1-2.4-1.1-.8-1.8-.7-1.8-.7z" fill="%23ffcc00"/><path d="M9 11l3-3 3 3-3 3-3-3z" fill="%23c0c0c0"/></svg>');
        }
        
        .extinguisher-projectile {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 10;
            transition: transform 0.5s, opacity 0.2s;
        }
        
        #level-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }
        
        #score-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }
        
        #feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 36px;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        #start-screen h1 {
            color: white;
            font-size: 36px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        #start-button {
            padding: 15px 30px;
            font-size: 24px;
            background-color: #ff4500;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        #start-button:hover {
            background-color: #ff6a33;
        }
        
        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        #game-over h1 {
            color: white;
            font-size: 36px;
            margin-bottom: 20px;
        }
        
        #final-score {
            color: white;
            font-size: 48px;
            margin-bottom: 30px;
        }
        
        #restart-button {
            padding: 15px 30px;
            font-size: 24px;
            background-color: #ff4500;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        #restart-button:hover {
            background-color: #ff6a33;
        }
        
        #info-button {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 200;
        }
        
        #info-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 200;
            display: none;
        }
        
        #info-panel h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .info-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #close-info {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            background-color: #ff4500;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #lives-container {
            position: absolute;
            top: 70px;
            left: 20px;
            display: flex;
            gap: 5px;
        }
        
        .life-icon {
            width: 30px;
            height: 30px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff4500"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            background-size: contain;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <video id="camera-view" autoplay></video>
        
        <div id="level-indicator">Level: 1</div>
        <div id="score-indicator">Score: 0</div>
        <div id="lives-container"></div>
        
        <div id="feedback">Perfect!</div>
        
        <button id="info-button">i</button>
        <div id="info-panel">
            <h2>Fire Type Guide</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-icon electrical-fire"></div>
                    <div>Electrical Fire: CO2 (Black)</div>
                </div>
                <div class="info-item">
                    <div class="info-icon gas-fire"></div>
                    <div>Gas Fire: Powder (Yellow)</div>
                </div>
                <div class="info-item">
                    <div class="info-icon wood-fire"></div>
                    <div>Wood Fire: Water (Red)</div>
                </div>
                <div class="info-item">
                    <div class="info-icon liquid-fire"></div>
                    <div>Liquid Fire: Foam (Blue)</div>
                </div>
                <div class="info-item">
                    <div class="info-icon metal-fire"></div>
                    <div>Metal Fire: Powder (Yellow)</div>
                </div>
            </div>
            <button id="close-info">Close</button>
        </div>
        
        <div id="game-ui">
            <div id="extinguisher-water" class="extinguisher" data-type="water"></div>
            <div id="extinguisher-foam" class="extinguisher" data-type="foam"></div>
            <div id="extinguisher-powder" class="extinguisher" data-type="powder"></div>
            <div id="extinguisher-co2" class="extinguisher" data-type="co2"></div>
        </div>
        
        <div id="start-screen">
            <h1>Fire Emergency<br>AR Training</h1>
            <button id="start-button">Start Training</button>
        </div>
        
        <div id="game-over">
            <h1>Training Complete</h1>
            <div id="final-score">Score: 0</div>
            <button id="restart-button">Train Again</button>
        </div>
    </div>

    <script>
        // Game variables
        let currentLevel = 1;
        let score = 0;
        let lives = 3;
        let gameActive = false;
        let activeFireElement = null;
        let activeFire = null;
        
        // DOM elements
        const gameContainer = document.getElementById('game-container');
        const cameraView = document.getElementById('camera-view');
        const levelIndicator = document.getElementById('level-indicator');
        const scoreIndicator = document.getElementById('score-indicator');
        const livesContainer = document.getElementById('lives-container');
        const feedback = document.getElementById('feedback');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const gameOverScreen = document.getElementById('game-over');
        const finalScore = document.getElementById('final-score');
        const restartButton = document.getElementById('restart-button');
        const infoButton = document.getElementById('info-button');
        const infoPanel = document.getElementById('info-panel');
        const closeInfoButton = document.getElementById('close-info');
        
        // Fire types and their correct extinguishers
        const fireTypes = [
            { class: 'electrical-fire', type: 'electrical', correctExtinguisher: 'co2' },
            { class: 'gas-fire', type: 'gas', correctExtinguisher: 'powder' },
            { class: 'wood-fire', type: 'wood', correctExtinguisher: 'water' },
            { class: 'liquid-fire', type: 'liquid', correctExtinguisher: 'foam' },
            { class: 'metal-fire', type: 'metal', correctExtinguisher: 'powder' }
        ];
        
        // Extinguisher colors
        const extinguisherColors = {
            'water': '#ff0000',
            'foam': '#0000ff',
            'powder': '#ffff00',
            'co2': '#000000'
        };
        
        // Positive feedback messages
        const positiveFeedback = [
            'Perfect!',
            'Great job!',
            'Excellent!',
            'Well done!',
            'Amazing!',
            'Fire out!',
            'Safety pro!'
        ];
        
        // Negative feedback messages
        const negativeFeedback = [
            'Wrong extinguisher!',
            'Try again!',
            'Not effective!',
            'Incorrect choice!',
            'Check your guide!'
        ];
        
        // Initialize game
        function initGame() {
            // Reset game state
            currentLevel = 1;
            score = 0;
            lives = 3;
            gameActive = true;
            
            // Update UI
            updateLevel();
            updateScore();
            updateLives();
            
            // Start first round
            spawnFire();
        }
        
        // Start camera
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                cameraView.srcObject = stream;
            } catch (err) {
                console.error("Error accessing camera: ", err);
                // Fallback to a solid background if camera access fails
                cameraView.style.display = 'none';
                gameContainer.style.backgroundColor = '#333';
            }
        }
        
        // Update level display
        function updateLevel() {
            levelIndicator.textContent = `Level: ${currentLevel}`;
        }
        
        // Update score display
        function updateScore() {
            scoreIndicator.textContent = `Score: ${score}`;
        }
        
        // Update lives display
        function updateLives() {
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const lifeIcon = document.createElement('div');
                lifeIcon.className = 'life-icon';
                livesContainer.appendChild(lifeIcon);
            }
        }
        
        // Spawn a new fire
        function spawnFire() {
            if (!gameActive) return;
            
            // Remove any existing fire
            if (activeFireElement) {
                gameContainer.removeChild(activeFireElement);
                activeFireElement = null;
                activeFire = null;
            }
            
            // Pick a random fire type, but weight towards different fires in higher levels
            let availableFires = fireTypes;
            if (currentLevel <= 2) {
                // Only basic fires in early levels
                availableFires = fireTypes.slice(0, 3);
            }
            
            // Create fire element
            const randomIndex = Math.floor(Math.random() * availableFires.length);
            activeFire = availableFires[randomIndex];
            
            activeFireElement = document.createElement('div');
            activeFireElement.className = `fire ${activeFire.class}`;
            
            // Position the fire randomly, but avoid edges
            const maxX = gameContainer.clientWidth - 100;
            const maxY = gameContainer.clientHeight - 250;
            const randomX = 50 + Math.floor(Math.random() * (maxX - 100));
            const randomY = 100 + Math.floor(Math.random() * (maxY - 200));
            
            activeFireElement.style.left = `${randomX}px`;
            activeFireElement.style.top = `${randomY}px`;
            
            // Add fire animation
            activeFireElement.animate([
                { transform: 'scale(0.95)' },
                { transform: 'scale(1.05)' }
            ], {
                duration: 1000,
                iterations: Infinity,
                direction: 'alternate',
                easing: 'ease-in-out'
            });
            
            gameContainer.appendChild(activeFireElement);
        }
        
        // Handle extinguisher click/touch
        function handleExtinguisherUse(e) {
            if (!gameActive || !activeFire) return;
            
            const extinguisherType = e.currentTarget.getAttribute('data-type');
            
            // Create projectile effect
            const projectile = document.createElement('div');
            projectile.className = 'extinguisher-projectile';
            projectile.style.backgroundColor = extinguisherColors[extinguisherType];
            
            // Start position (from extinguisher)
            const extRect = e.currentTarget.getBoundingClientRect();
            projectile.style.left = `${extRect.left + extRect.width/2 - 15}px`;
            projectile.style.top = `${extRect.top - 30}px`;
            
            gameContainer.appendChild(projectile);
            
            // Move to fire position
            const fireRect = activeFireElement.getBoundingClientRect();
            const targetX = fireRect.left + fireRect.width/2 - 15;
            const targetY = fireRect.top + fireRect.height/2 - 15;
            
            setTimeout(() => {
                projectile.style.transform = `translate(${targetX - (extRect.left + extRect.width/2 - 15)}px, ${targetY - (extRect.top - 30)}px)`;
                
                // Check if correct extinguisher was used
                setTimeout(() => {
                    gameContainer.removeChild(projectile);
                    
                    if (extinguisherType === activeFire.correctExtinguisher) {
                        // Correct extinguisher
                        handleCorrectExtinguisher();
                    } else {
                        // Wrong extinguisher
                        handleWrongExtinguisher();
                    }
                }, 500);
            }, 50);
        }
        
        // Handle correct extinguisher
        function handleCorrectExtinguisher() {
            // Add score based on level
            score += currentLevel * 10;
            updateScore();
            
            // Show positive feedback
            const randomFeedback = positiveFeedback[Math.floor(Math.random() * positiveFeedback.length)];
            showFeedback(randomFeedback, '#4CAF50');
            
            // Fade out fire
            activeFireElement.style.opacity = '0';
            
            setTimeout(() => {
                if (activeFireElement && activeFireElement.parentNode) {
                    gameContainer.removeChild(activeFireElement);
                }
                activeFireElement = null;
                
                // Advance to next level after every 3 correct fires
                if (score >= currentLevel * 30) {
                    currentLevel++;
                    updateLevel();
                }
                
                // Spawn next fire
                setTimeout(() => {
                    spawnFire();
                }, 1000);
            }, 500);
        }
        
        // Handle wrong extinguisher
        function handleWrongExtinguisher() {
            // Show negative feedback
            const randomFeedback = negativeFeedback[Math.floor(Math.random() * negativeFeedback.length)];
            showFeedback(randomFeedback, '#F44336');
            
            // Lose a life
            lives--;
            updateLives();
            
            if (lives <= 0) {
                endGame();
            }
        }
        
        // Show feedback message
        function showFeedback(message, color) {
            feedback.textContent = message;
            feedback.style.backgroundColor = color;
            feedback.style.opacity = '1';
            
            setTimeout(() => {
                feedback.style.opacity = '0';
            }, 1500);
        }
        
        // End game
        function endGame() {
            gameActive = false;
            
            // Remove active fire if exists
            if (activeFireElement && activeFireElement.parentNode) {
                gameContainer.removeChild(activeFireElement);
                activeFireElement = null;
            }
            
            // Show game over screen
            finalScore.textContent = `Score: ${score}`;
            gameOverScreen.style.display = 'flex';
        }
        
        // Add swipe functionality to extinguishers
        const extinguishers = document.querySelectorAll('.extinguisher');
        extinguishers.forEach(extinguisher => {
            extinguisher.addEventListener('click', handleExtinguisherUse);
            
            // Touch events for mobile
            let touchStartX = 0;
            let touchStartY = 0;
            
            extinguisher.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            
            extinguisher.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                // Calculate distance
                const distance = Math.sqrt(
                    Math.pow(touchEndX - touchStartX, 2) + 
                    Math.pow(touchEndY - touchStartY, 2)
                );
                
                // If it was a swipe up (distance > 50px and mostly vertical)
                if (distance > 50 && Math.abs(touchEndY - touchStartY) > Math.abs(touchEndX - touchStartX) && touchEndY < touchStartY) {
                    handleExtinguisherUse(e);
                }
            });
        });
        
        // Start button event
        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            initGame();
        });
        
        // Restart button event
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            initGame();
        });
        
        // Info button events
        infoButton.addEventListener('click', () => {
            infoPanel.style.display = 'block';
        });
        
        closeInfoButton.addEventListener('click', () => {
            infoPanel.style.display = 'none';
        });
        
        // Initialize camera when page loads
        document.addEventListener('DOMContentLoaded', () => {
            startCamera();
            
            // Set up lives display
            updateLives();
        });
        
        // Handle device orientation changes
        window.addEventListener('orientationchange', () => {
            // Small delay to allow resize to complete
            setTimeout(() => {
                if (activeFireElement) {
                    // Reposition fire if it's off-screen after orientation change
                    const maxX = gameContainer.clientWidth - 100;
                    const maxY = gameContainer.clientHeight - 250;
                    
                    let fireX = parseInt(activeFireElement.style.left);
                    let fireY = parseInt(activeFireElement.style.top);
                    
                    if (fireX > maxX) fireX = maxX;
                    if (fireY > maxY) fireY = maxY;
                    
                    activeFireElement.style.left = `${fireX}px`;
                    activeFireElement.style.top = `${fireY}px`;
                }
            }, 300);
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // Similar to orientation change logic
            if (activeFireElement) {
                const maxX = gameContainer.clientWidth - 100;
                const maxY = gameContainer.clientHeight - 250;
                
                let fireX = parseInt(activeFireElement.style.left);
                let fireY = parseInt(activeFireElement.style.top);
                
                if (fireX > maxX) fireX = maxX;
                if (fireY > maxY) fireY = maxY;
                
                activeFireElement.style.left = `${fireX}px`;
                activeFireElement.style.top = `${fireY}px`;
            }
        });
        
        // Add keyboard controls for accessibility
        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            
            switch(e.key) {
                case '1':
                    // Water extinguisher
                    document.getElementById('extinguisher-water').click();
                    break;
                case '2':
                    // Foam extinguisher
                    document.getElementById('extinguisher-foam').click();
                    break;
                case '3':
                    // Powder extinguisher
                    document.getElementById('extinguisher-powder').click();
                    break;
                case '4':
                    // CO2 extinguisher
                    document.getElementById('extinguisher-co2').click();
                    break;
                case 'i':
                    // Toggle info panel
                    infoPanel.style.display = infoPanel.style.display === 'block' ? 'none' : 'block';
                    break;
            }
        });
        
        // Add timer for advanced gameplay in higher levels
        let timerInterval = null;
        let timeRemaining = 0;
        
        function startTimer(seconds) {
            timeRemaining = seconds;
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    // If player didn't extinguish in time
                    if (activeFireElement) {
                        lives--;
                        updateLives();
                        showFeedback('Too slow!', '#F44336');
                        
                        if (lives <= 0) {
                            endGame();
                        } else {
                            spawnFire();
                        }
                    }
                }
            }, 1000);
        }
        
        // Function to add difficulty based on level
        function updateDifficulty() {
            // Higher levels have shorter time limits
            const timeLimit = Math.max(10, 20 - currentLevel);
            startTimer(timeLimit);
            
            // Higher levels have smaller fires that are harder to hit
            if (activeFireElement) {
                const scale = Math.max(0.6, 1 - (currentLevel * 0.05));
                activeFireElement.style.transform = `scale(${scale})`;
            }
        }
        
        // Update spawnFire function to include difficulty
        const originalSpawnFire = spawnFire;
        spawnFire = function() {
            originalSpawnFire();
            updateDifficulty();
        };
    </script>
</body>
</html>